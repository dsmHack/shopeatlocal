{{!-- pScriptUpImg.hbs
//    ----------------
//    Image upload script
//
// This script adds support for image 'remove' and 'restore' buttons.
//
// I would like to clear the 'new image' selection if the user restores the
// original image, but I cannot find a way to stop the browser from submitting
// the file selection. Clearing the LblImg text removes the name text, but it
// does not stop the submission. Neither does removing the Img value, or setting
// it to 'null' or the empty string. I could add a 'CkRestImg' flag, but I would
// rather not: [TO DO]
//
//   https://stackoverflow.com/questions/1703228/how-can-i-clear-an-html-file-input-with-javascript
//
--}}

// User can upload images, they appear on the UI, and can be removed
//  Update UI to read from images and dynamically create a carousel of them
//  Make remove button remove the image from the carousel AND input
// User can remove individual images from the UI
//  Update the input to contain 
//  Update button to remove the im

<script>
	function removeFileFromInput(fileIndex, inputElement) {
		const dt = new DataTransfer();
		const { files } = inputElement;

		for (let i = 0; i < files.length; i++) {
			if (i !== fileIndex) {
				dt.items.add(files[i]);
			}
		}

		inputElement.files = dt.files;
	}
	$('#Img').on('input', function () {
		const files = this.files;
		// setup carousel
		// set CkKeepImgs
	})
	$("#BtnRemImg").on("click", function () {
		const carouselImageIndex = [...document.querySelectorAll('.carousel-item')].findIndex(div => div.classList.contains('active'));
		$("#BtnRemImg").addClass("d-none");
		removeFileFromInput(carouselImageIndex, document.querySelector("#CkRemImg"));
		document.querySelectorAll('.carousel-indicators li')[carouselImageIndex].remove();
		document.querySelectorAll('.carousel-item')[carouselImageIndex].remove();
		const indicators = document.querySelectorAll('.carousel-indicators li');
		if (indicators[carouselImageIndex + 1]) {
			indicators[carouselImageIndex + 1].click();
		} else if (indicators[carouselImageIndex - 1]) {
			indicators[carouselImageIndex - 1].click();
		} else {
			document.querySelector("#productCarousel").remove();
		}
		const keepingImages = document.querySelector('#CkKeepImgs')
		// remove Nth image from the 
	});
</script>
